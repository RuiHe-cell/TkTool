# TKTool 自动更新系统使用指南

## 🚀 功能概述

本自动更新系统基于GitHub实现，提供以下功能：

- ✅ **自动检查更新**：程序启动时自动检查GitHub上的最新版本
- ✅ **版本管理**：简化版本号管理和更新内容编辑
- ✅ **自动上传**：一键将更新信息推送到GitHub仓库
- ✅ **用户友好**：提供图形化界面和批处理脚本

## 📋 使用前准备

### 1. 创建GitHub仓库

1. 访问 [GitHub](https://github.com) 并登录
2. 点击右上角的 "+" 按钮，选择 "New repository"
3. 填写仓库名称（如：`TKTool`）
4. 选择 "Public"（公开仓库，免费用户推荐）
5. 勾选 "Add a README file"
6. 点击 "Create repository"

### 2. 配置本地Git环境

确保您的电脑已安装Git：

```bash
# 检查Git是否已安装
git --version

# 如果未安装，请访问 https://git-scm.com/ 下载安装
```

配置Git用户信息：

```bash
git config --global user.name "您的用户名"
git config --global user.email "您的邮箱"
```

## 🛠️ 快速开始

### 方法一：使用批处理脚本（推荐）

1. 双击运行 `快速更新.bat`
2. 选择 "1" 配置GitHub仓库
3. 填写您的GitHub用户名和仓库名称
4. 点击 "测试连接" 验证配置
5. 点击 "保存配置" 完成设置

### 方法二：使用Python脚本

```bash
# 配置GitHub仓库
python scripts/setup_config.py --interactive

# 或者命令行配置
python scripts/setup_config.py --username your-username --repo your-repo
```

## 📝 版本更新流程

### 1. 图形化更新（推荐）

```bash
# 打开版本更新工具
python scripts/update_version.py --interactive
```

或者：
1. 运行 `快速更新.bat`
2. 选择 "2" 版本更新工具

在图形界面中：
1. 输入新版本号（自动递增）
2. 编辑更新内容
3. 点击 "更新并上传" 完成所有操作

### 2. 命令行更新

```bash
# 快速更新（自动递增patch版本）
python scripts/update_version.py --quick

# 指定版本号和更新内容
python scripts/update_version.py --version 1.2.0 --content "新增功能" "修复bug"

# 仅更新不上传
python scripts/update_version.py --version 1.2.0 --no-upload
```

### 3. 批处理快速更新

1. 双击运行 `快速更新.bat`
2. 选择 "3" 快速更新版本
3. 系统自动递增版本号并上传

## 🔍 检查更新

### 自动检查

程序启动时会自动在后台检查更新（延迟2秒，不影响启动速度）。

### 手动检查

1. **在程序中**：点击菜单栏 "帮助" → "检查更新"
2. **批处理脚本**：运行 `快速更新.bat`，选择 "4"
3. **命令行**：
   ```bash
   python -c "from core.update_checker import UpdateChecker; UpdateChecker().manual_check_update()"
   ```

## ⚙️ 配置文件说明

### update_config.json

```json
{
    "github_raw_url": "GitHub raw文件URL",
    "github_page_url": "GitHub页面URL",
    "check_on_startup": true,        // 启动时检查更新
    "timeout": 10,                   // 网络超时时间
    "auto_update_local": true,       // 自动更新本地文件
    "show_update_dialog": true,      // 显示更新对话框
    "update_check_interval": 3600    // 检查间隔（秒）
}
```

### git_config.json

```json
{
    "remote_name": "origin",         // 远程仓库名称
    "branch_name": "main",           // 分支名称
    "auto_add_all": false,           // 是否自动添加所有文件
    "files_to_track": [              // 要跟踪的文件
        "INFO/update.json",
        "README.md",
        "config/"
    ],
    "commit_template": "更新版本信息 - {timestamp}",
    "github_username": "your-username",
    "github_repo": "your-repo",
    "github_token": ""               // GitHub Token（可选）
}
```

## 🔧 高级功能

### 版本号规则

系统支持语义化版本号（Semantic Versioning）：

- **Major（主版本）**：不兼容的API修改
- **Minor（次版本）**：向下兼容的功能性新增
- **Patch（修订版本）**：向下兼容的问题修正

```bash
# 递增不同类型的版本号
python scripts/update_version.py --type major   # 1.0.0 → 2.0.0
python scripts/update_version.py --type minor   # 1.0.0 → 1.1.0
python scripts/update_version.py --type patch   # 1.0.0 → 1.0.1
```

### GitHub Token配置

如果您使用私有仓库或需要更高的API限制，可以配置GitHub Token：

1. 访问 [GitHub Token设置](https://github.com/settings/tokens)
2. 点击 "Generate new token (classic)"
3. 选择适当的权限（repo权限）
4. 复制生成的Token
5. 在配置界面中填入Token

### 自定义提交信息

```bash
# 使用自定义提交信息
python scripts/update_version.py --version 1.2.0 --message "重大更新：新增AI功能"
```

## 🐛 常见问题

### Q: 程序启动时提示更新检查失败

**A:** 检查以下几点：
1. 网络连接是否正常
2. GitHub仓库配置是否正确
3. 仓库是否为公开状态

### Q: 上传失败，提示Git错误

**A:** 可能的解决方案：
1. 确保已安装Git并配置用户信息
2. 检查仓库URL是否正确
3. 确保有仓库的写入权限
4. 尝试手动执行 `git push` 查看详细错误

### Q: 版本比较不准确

**A:** 确保版本号格式为 `x.y.z`（如：1.0.0），避免使用其他格式。

### Q: 无法访问GitHub

**A:** 如果网络环境无法访问GitHub，可以考虑：
1. 使用VPN或代理
2. 改用Gitee等国内Git服务
3. 修改配置文件中的URL

## 📞 技术支持

如果您在使用过程中遇到问题：

1. 查看控制台输出的错误信息
2. 检查配置文件是否正确
3. 确认网络连接和Git环境
4. 查看GitHub仓库的访问权限

## 🎉 使用技巧

1. **定期备份**：建议定期备份重要的配置文件
2. **版本规划**：合理规划版本号，遵循语义化版本规则
3. **更新内容**：详细描述每次更新的内容，方便用户了解
4. **测试验证**：更新前先测试功能是否正常

---

**祝您使用愉快！** 🎊